<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Immigration & Customs - Moving to Vietnam</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@500;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-color: #f4f1ee;
    --text-color: #3e2723;
    --accent-brown: #5d4037;
    --accent-terracotta: #a0522d;
    --card-bg: #ffffff;
    --border-color: #d7ccc8;
  }

  body { 
    font-family: 'Noto Serif JP', serif; 
    background-color: var(--bg-color); 
    color: var(--text-color);
    margin: 0; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    min-height: 100vh; 
  }

  .container {
    width: 90vw;
    max-width: 650px;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    border: 1px solid var(--border-color);
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--bg-color);
    padding-bottom: 10px;
  }

  h1 { font-family: 'Playfair Display', serif; font-size: 1.4rem; margin: 0; color: var(--accent-terracotta); }

  .settings { font-size: 0.9rem; display: flex; align-items: center; gap: 10px; }
  .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
  .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
  input:checked + .slider { background-color: var(--accent-terracotta); }
  input:checked + .slider:before { transform: translateX(20px); }

  .progress-bar { height: 4px; background: #e0e0e0; margin-bottom: 20px; border-radius: 2px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--accent-terracotta); width: 0%; transition: width 0.3s; }

  /* UPDATED: Left aligned text and flex-start alignment */
  .question-area { 
    text-align: left; 
    margin-bottom: 30px; 
    min-height: 120px; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: flex-start; /* Aligns items to the left */
    padding: 0 10px; /* Added padding so text doesn't hit the edge */
  }
  
  .question-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 10px; display: block; line-height: 1.6; }
  .category-tag { font-size: 0.8rem; color: var(--accent-brown); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; font-weight: bold; background: #efebe9; padding: 4px 12px; border-radius: 12px; }

  .choices-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
  .choice-btn {
    background: none;
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.2s;
    color: var(--text-color);
    text-align: left;
    font-family: 'Noto Serif JP', serif;
  }
  .choice-btn:hover { background-color: #fdfaf8; border-color: var(--accent-terracotta); }
  .choice-btn.selected { background-color: var(--accent-terracotta) !important; color: white; border-color: var(--accent-terracotta); }
  .choice-btn.correct { background-color: #4e6e4e !important; color: white; border-color: #4e6e4e; }
  .choice-btn.wrong { background-color: #a66e6e !important; color: white; border-color: #a66e6e; opacity: 0.6; }

  .footer-actions { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; align-items: center; }
  .main-btn {
    width: 100%;
    padding: 15px;
    border-radius: 30px;
    border: none;
    background-color: var(--accent-brown);
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  .main-btn:disabled { background-color: #ccc; cursor: not-allowed; }
  .print-link { font-size: 0.8rem; text-decoration: underline; cursor: pointer; color: var(--accent-brown); background: none; border: none; }

  /* Print Styles */
  .print-header { display: none; }
  #printWorksheet { display: none; }

  @media print {
    body { background: white; color: black; display: block; padding: 0; }
    .container { display: none !important; }
    
    .print-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: baseline; 
      border-bottom: 2px solid #000; 
      margin-bottom: 20px; 
      padding-bottom: 5px;
    }
    .print-header h1 { font-size: 1.4rem; color: black; }
    .name-box { font-size: 0.9rem; }

    #printWorksheet { display: block; width: 100%; }
    .ws-section-title { font-size: 1.1rem; font-weight: bold; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    .ws-item { 
      margin-bottom: 15px; 
      page-break-inside: avoid; 
      padding-bottom: 10px;
    }
    .ws-question { font-size: 0.95rem; font-weight: bold; margin-bottom: 5px; }
    .ws-choices { margin-left: 15px; }
    .ws-choice { font-size: 0.9rem; margin-bottom: 2px; }
    .checkbox { width: 10px; height: 10px; border: 1px solid #000; display: inline-block; margin-right: 8px; }
  }
</style>
</head>
<body>

<div class="container" id="quizContainer">
  <header>
    <h1>Immigration & Customs</h1>
    <div class="settings">
      <span>Audio</span>
      <label class="switch">
        <input type="checkbox" id="audioToggle" checked>
        <span class="slider"></span>
      </label>
    </div>
  </header>

  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

  <div id="gameBody">
    <div class="question-area">
      <span class="category-tag" id="categoryTag">Category</span>
      <span class="question-text" id="questionText">Loading...</span>
    </div>

    <div class="choices-grid" id="choicesGrid"></div>

    <div class="footer-actions">
      <button class="main-btn" id="actionBtn" onclick="handleAction()" disabled>Check Answer</button>
      <button class="print-link" onclick="window.print()">Print Worksheet</button>
    </div>
  </div>
</div>

<div id="printWorksheet">
  <div class="print-header">
    <h1>Immigration & Customs: Vietnam Relocation</h1>
    <div class="name-box">Date: ________ Name: ________________</div>
  </div>
  <div id="wsList"></div>
</div>

<script>
// Quiz Data Configuration
const quizData = [
  // Quiz 1: Multiple Choice
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "At immigration, the officer asks: “What is the purpose of your visit?” What is the best answer?",
    options: ["“I’m tired.”", "“I am relocating for business.”", "“I want to buy a souvenir.”"],
    correct: 1
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "Which documents did Hamano-San show to the officer?",
    // Updated Option A to include business documents
    options: ["Passport, visa, school papers, and business documents", "A map of Hanoi and a bus ticket", "Only a credit card"],
    correct: 0
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "The officer says: “Look at the camera, please.” What should they do?",
    options: ["Show their passports again", "Face the camera for a photo", "Put their luggage on the scanner"],
    correct: 1
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "Where will Hamano-San and her daughter be staying?",
    options: ["At a hotel near the airport", "In an apartment in the Tay Ho district", "At a primary school"],
    correct: 1
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "How long does Hamano-San plan to stay in Vietnam?",
    options: ["Six days", "Six months", "Six years"],
    correct: 2
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "The officer asks for 'school enrollment papers' because:",
    options: ["The daughter is starting primary school", "The officer wants to learn Japanese", "They are looking for a library"],
    correct: 0
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "What is Hamano-San’s profession?",
    options: ["A pilot", "A Beauty Consultant", "A police officer"],
    correct: 1
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "At customs, “Do you have anything to declare?” means:",
    options: ["“Do you have items needing inspection?”", "“Do you want to make a complaint?”", "“Did you lose your luggage?”"],
    correct: 0
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "When arriving at the airport, where do you pick up your suitcases?",
    options: ["Departure gate", "Baggage claim", "Check-in counter"],
    correct: 1
  },
  {
    type: "mc",
    cat: "Quiz 1: Scenario",
    q: "What does the officer say at the end of the conversation?",
    options: ["“Goodbye and good luck.”", "“Please go back to Japan.”", "“Welcome to Vietnam.”"],
    correct: 2
  },

  // Quiz 2: Fill-in-the-Blank
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “May I see your passports and ________, please?”",
    options: ["visas", "tickets", "photos"],
    correct: 0
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “What is the purpose of your ________?”",
    // UPDATED: Changed "stay" to "ticket" to avoid confusion
    options: ["ticket", "visit", "lunch"],
    correct: 1
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Hamano-San: “I am relocating for ________.”",
    options: ["vacation", "business", "sightseeing"],
    correct: 1
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Hamano-San: “My daughter will start ________ school here.”",
    options: ["primary", "high", "driving"],
    correct: 0
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “Do you have any ________ documents?”",
    options: ["travel", "business", "family"],
    correct: 1
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “Where will you be ________?”",
    options: ["staying", "shopping", "working"],
    correct: 0
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “How ________ will you be staying in Vietnam?”",
    options: ["much", "long", "far"],
    correct: 1
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "Officer: “Now, look at the ________, please.”",
    options: ["ceiling", "floor", "camera"],
    correct: 2
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "After arriving, go to ________ to get your bags.",
    options: ["baggage claim", "check-in", "security"],
    correct: 0
  },
  {
    type: "blank",
    cat: "Quiz 2: Vocabulary",
    q: "At customs: “Do you have anything to ________?”",
    options: ["hide", "declare", "eat"],
    correct: 1
  }
];

let currentIndex = 0;
let selectedIndex = -1;
let isChecked = false;

// Audio Function
function speak(text) {
  if (!document.getElementById('audioToggle').checked) return;
  // Clean text for speech (remove underscores or special chars if needed)
  const cleanText = text.replace(/_/g, "blank").replace(/“|”/g, "");
  const uttr = new SpeechSynthesisUtterance(cleanText);
  uttr.lang = "en-US";
  uttr.rate = 0.9;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(uttr);
}

// Generate Printable Worksheet
function generateWorksheet() {
  const wsList = document.getElementById('wsList');
  wsList.innerHTML = "";
  
  // Section 1 Header
  let div1 = document.createElement('div');
  div1.innerHTML = `<div class="ws-section-title">Quiz 1: Multiple Choice (Scenario)</div>`;
  wsList.appendChild(div1);

  quizData.forEach((item, index) => {
    if(index === 10) {
      let div2 = document.createElement('div');
      div2.innerHTML = `<div class="ws-section-title">Quiz 2: Fill-in-the-Blank</div>`;
      wsList.appendChild(div2);
    }

    const itemDiv = document.createElement('div');
    itemDiv.className = "ws-item";
    
    // Display options with checkboxes
    const optionsHtml = item.options.map((opt, i) => {
      const label = ["A", "B", "C"][i];
      return `<div class="ws-choice"><span class="checkbox"></span> <b>${label}.</b> ${opt}</div>`;
    }).join('');

    itemDiv.innerHTML = `
      <div class="ws-question">${index + 1}. ${item.q}</div>
      <div class="ws-choices">${optionsHtml}</div>
    `;
    wsList.appendChild(itemDiv);
  });
}

// Load Game Question
function loadQuestion() {
  const item = quizData[currentIndex];
  isChecked = false;
  selectedIndex = -1;
  
  // Update UI
  document.getElementById('progressFill').style.width = `${(currentIndex / quizData.length) * 100}%`;
  document.getElementById('categoryTag').textContent = item.cat;
  document.getElementById('questionText').textContent = item.q;
  
  const actionBtn = document.getElementById('actionBtn');
  actionBtn.textContent = "Check Answer";
  actionBtn.disabled = true;
  actionBtn.style.backgroundColor = "var(--accent-brown)";

  const grid = document.getElementById('choicesGrid');
  grid.innerHTML = "";
  
  item.options.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = "choice-btn";
    btn.textContent = opt;
    btn.onclick = () => selectOption(idx, btn);
    grid.appendChild(btn);
  });
}

function selectOption(idx, btn) {
  if (isChecked) return;
  selectedIndex = idx;
  
  // Visual Selection
  document.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  
  document.getElementById('actionBtn').disabled = false;
  
  // Read the selected option out loud
  speak(quizData[currentIndex].options[idx]);
}

function handleAction() {
  const item = quizData[currentIndex];
  const actionBtn = document.getElementById('actionBtn');
  const buttons = document.querySelectorAll('.choice-btn');

  if (!isChecked) {
    // Check Answer Phase
    isChecked = true;
    let isCorrect = (selectedIndex === item.correct);
    
    buttons.forEach((btn, idx) => {
      if (idx === item.correct) btn.classList.add('correct');
      else if (idx === selectedIndex) btn.classList.add('wrong');
    });

    if (isCorrect) {
      actionBtn.textContent = "Correct! Next →";
      actionBtn.style.backgroundColor = "#4e6e4e";
    } else {
      actionBtn.textContent = "Next Question →";
      actionBtn.style.backgroundColor = "#a66e6e";
    }
  } else {
    // Next Question Phase
    currentIndex++;
    if (currentIndex < quizData.length) {
      loadQuestion();
    } else {
      showResult();
    }
  }
}

function showResult() {
  document.getElementById('gameBody').innerHTML = `
    <div style="text-align:center; padding: 40px 0;">
      <h2 style="color:var(--accent-terracotta); font-family:'Playfair Display', serif;">Relocation Ready!</h2>
      <p style="margin: 20px 0; font-size: 1.1rem;">
        You have completed the Immigration & Customs simulation.<br>
        Hamano-San is ready for her new life in Vietnam.
      </p>
      <button class="main-btn" onclick="location.reload()">Restart Simulation</button>
    </div>
  `;
  document.getElementById('progressFill').style.width = "100%";
}

// Initialize
generateWorksheet();
loadQuestion();
</script>
</body>
</html>